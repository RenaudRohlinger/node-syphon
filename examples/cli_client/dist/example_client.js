"use strict";const e=require("node-syphon");let o,n,r;(()=>{try{process.stdin.resume(),["exit","SIGINT","SIGUSR1","SIGUSR2","uncaughtException","SIGTERM"].forEach((e=>{process.on(e,(()=>{(r||n)&&(console.log("End program",e),clearInterval(o),null==n||n.dispose(),null==r||r.dispose(),n=null,r=null)}))})),n=new e.SyphonServerDirectory,n.on(e.SyphonServerDirectoryListenerChannel.SyphonServerAnnounceNotification,(e=>{console.log("Server announce",e),console.log(n.servers)})),n.on(e.SyphonServerDirectoryListenerChannel.SyphonServerRetireNotification,(e=>{console.log("Server retire",e),console.log(n.servers)})),n.listen(),o=setInterval((async()=>{n.servers.length>0&&!r?(console.log("Create"),r=new e.SyphonOpenGLClient(n.servers[n.servers.length-1])):0===n.servers.length&&r?(console.log("Dispose"),r.dispose(),r=null):r&&(console.log(await r.newFrame),console.log(r.width,r.height))}),1e3/60)}catch(s){console.error(s),process.exit(0)}})();
